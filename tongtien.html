<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>T√≠nh t·ªïng ti·ªÅn t·ª´ Excel</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; display: flex; gap: 40px; }
    textarea, input { width: 100%; margin-top: 8px; padding: 6px; }
    textarea { height: 150px; }
    .result { margin-top: 20px; font-weight: bold; }
    hr { margin: 12px 0; }
    .container { flex: 1; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    table, th, td { border: 1px solid #ccc; }
    th, td { padding: 6px; text-align: center; }
    .denominations { flex: 1; }
  </style>
</head>
<body>
  <!-- B√äN TR√ÅI: Nh·∫≠p Excel + T√≠nh t·ªïng -->
  <div class="container">
    <h2>T√≠nh t·ªïng ti·ªÅn t·ª´ Excel</h2>
    <p>D√°n d·ªØ li·ªáu copy t·ª´ Excel v√†o √¥ d∆∞·ªõi ƒë√¢y:</p>
    
    <textarea id="excelData" placeholder="D√°n d·ªØ li·ªáu t·ª´ Excel v√†o ƒë√¢y..."></textarea>
    
    <input type="number" id="tienQuay" placeholder="Nh·∫≠p ti·ªÅn thu t·∫°i qu·∫ßy (VND)">
    <input type="number" id="tienTru" placeholder="Nh·∫≠p ti·ªÅn tr·ª´ (VND)">
    
    <button onclick="tinhTong()">T√≠nh t·ªïng</button>
    <button onclick="truThem()">Tr·ª´ th√™m</button>
    
    <div class="result">
      T·ªïng ti·ªÅn t·ª´ Excel: <span id="excelTotal">0</span> VND<br>
      Ti·ªÅn thu t·∫°i qu·∫ßy: <span id="quayTotal">0</span> VND<br>
      <hr>
      üëâ T·ªïng tr∆∞·ªõc khi tr·ª´: <span id="beforeTru">0</span> VND<br>
      T·ªïng ti·ªÅn ƒë√£ tr·ª´: <span id="truTotal">0</span> VND<br>
      <hr>
      ‚úÖ T·ªïng cu·ªëi c√πng sau khi tr·ª´: <span id="finalTotal">0</span> VND<br>
      Ng∆∞·ªùi t·∫°o: <span id="creator">Ch∆∞a x√°c ƒë·ªãnh</span>
    </div>
  </div>

  <!-- B√äN PH·∫¢I: B·∫£ng m·ªánh gi√° -->
  <div class="denominations">
    <h2>B·∫£ng m·ªánh gi√°</h2>
    <table>
      <thead>
        <tr>
          <th>M·ªánh gi√°</th>
          <th>S·ªë t·ªù</th>
          <th>Th√†nh ti·ªÅn</th>
        </tr>
      </thead>
      <tbody id="menhGiaTable">
        <!-- Sinh ra t·ª± ƒë·ªông b·∫±ng JS -->
      </tbody>
    </table>
    <div class="result">
      üíµ T·ªïng ti·ªÅn m·∫∑t: <span id="tongMenhGia">0</span> VND
    </div>
  </div>

  <script>
    // ============ PH·∫¶N T√çNH T·ªîNG T·ª™ EXCEL ============
    let tongExcel = 0;
    let tongQuay = 0;
    let tongCuoi = 0;
    let tongTru = 0;  // bi·∫øn t√≠ch l≈©y ti·ªÅn tr·ª´
    let creator = "";

    function tinhTong() {
      let raw = document.getElementById('excelData').value.trim();
      tongQuay = parseFloat(document.getElementById('tienQuay').value.replace(/[^0-9]/g, "")) || 0;
      tongTru = 0; // reset l·∫°i khi t√≠nh t·ªïng m·ªõi
      
      if (!raw) {
        alert("B·∫°n ch∆∞a nh·∫≠p d·ªØ li·ªáu!");
        return;
      }
      
      let rows = raw.split("\n");
      tongExcel = 0;
      creator = "";

      rows.forEach((row, index) => {
        let cols = row.split("\t");
        
        // B·ªè qua d√≤ng ti√™u ƒë·ªÅ
        if (index === 0 && isNaN(parseFloat(cols[2]))) {
          return;
        }
        
        // C·ªôt 3 = ti·ªÅn thu
        let moneyStr = cols[2] ? cols[2].replace(/[^0-9]/g, "") : "0";
        let money = parseFloat(moneyStr);
        if (!isNaN(money)) {
          tongExcel += money;
        }

        // L·∫•y ng∆∞·ªùi t·∫°o t·ª´ c·ªôt 4
        if (!creator && cols[3]) {
          creator = cols[3];
        }
      });

      tongCuoi = tongExcel + tongQuay;
      capNhatKetQua();
    }

    function truThem() {
      let soTru = parseFloat(document.getElementById('tienTru').value.replace(/[^0-9]/g, "")) || 0;
      tongTru += soTru; // c·ªông d·ªìn
      capNhatKetQua();
    }

    function capNhatKetQua() {
      let tongSauTru = tongCuoi - tongTru;

      document.getElementById('excelTotal').innerText = tongExcel.toLocaleString("vi-VN");
      document.getElementById('quayTotal').innerText = tongQuay.toLocaleString("vi-VN");
      document.getElementById('beforeTru').innerText = tongCuoi.toLocaleString("vi-VN");
      document.getElementById('truTotal').innerText = tongTru.toLocaleString("vi-VN");
      document.getElementById('finalTotal').innerText = tongSauTru.toLocaleString("vi-VN");
      document.getElementById('creator').innerText = creator || "Kh√¥ng x√°c ƒë·ªãnh";
    }

    // ============ PH·∫¶N B·∫¢NG M·ªÜNH GI√Å ============
    const menhGia = [500000, 200000, 100000, 50000, 20000, 10000, 5000, 2000, 1000];
    const tableBody = document.getElementById("menhGiaTable");

    menhGia.forEach(mg => {
      let tr = document.createElement("tr");

      let tdMenhGia = document.createElement("td");
      tdMenhGia.innerText = mg.toLocaleString("vi-VN");
      
      let tdSoTo = document.createElement("td");
      let input = document.createElement("input");
      input.type = "number";
      input.min = "0";
      input.value = "0";
      input.style.width = "80px";
      input.oninput = tinhMenhGia;
      tdSoTo.appendChild(input);
      
      let tdThanhTien = document.createElement("td");
      tdThanhTien.innerText = "0";
      tdThanhTien.className = "thanhTien";

      tr.appendChild(tdMenhGia);
      tr.appendChild(tdSoTo);
      tr.appendChild(tdThanhTien);

      tableBody.appendChild(tr);
    });

    function tinhMenhGia() {
      let rows = tableBody.querySelectorAll("tr");
      let tong = 0;

      rows.forEach((row, i) => {
        let soTo = parseInt(row.querySelector("input").value) || 0;
        let tien = menhGia[i] * soTo;
        row.querySelector(".thanhTien").innerText = tien.toLocaleString("vi-VN");
        tong += tien;
      });

      document.getElementById("tongMenhGia").innerText = tong.toLocaleString("vi-VN");
    }
  </script>
</body>
</html>
